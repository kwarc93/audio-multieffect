/*
 * vocoder.hpp
 *
 *  Created on: 24 sty 2024
 *      Author: kwarc
 */

#ifndef MODEL_VOCODER_VOCODER_HPP_
#define MODEL_VOCODER_VOCODER_HPP_

#include "app/model/effect_interface.hpp"

#include <array>

#include <libs/audio_dsp.hpp>

#define VOCODER_ALG_FFT

namespace mfx
{

class vocoder : public effect
{
public:
    vocoder (float clarity = 0.5f, bool hold = false);
    virtual ~vocoder ();

    void process(const dsp_input &in, dsp_output &out) override;
    const effect_specific_attributes get_specific_attributes(void) const override;

    void set_clarity(float clarity);
    void hold(bool state);

private:
#ifndef VOCODER_ALG_FFT
    class filter_bank
    {
    public:
        filter_bank()
        {
            for (unsigned i = 0; i < this->bands; i++)
                this->bandpass_filters[i].set_coeffs(this->bandpass_coeffs[i]);

            for (auto &&f : this->lowpass_filters)
                f.set_coeffs(this->lowpass_coeffs);
        }

        void bandpass(uint32_t band, const float *in, float *out, uint32_t samples)
        {
            this->bandpass_filters[band].process(in, out, samples);
        }

        void lowpass(uint32_t band, const float *in, float *out, uint32_t samples)
        {
            this->lowpass_filters[band].process(in, out, samples);
        }

        static constexpr uint32_t bands {16};

    private:
        /* Lowpass filter (RMS envelope) */
        static constexpr std::array<float, 5> lowpass_coeffs { 0, 0, 1, 1.98f, -0.9801f};

        /* Band: 1: 50 - 159[Hz] */
        static constexpr std::array<float, 10> bandpass_1_coeffs
        {
            0.0000253908432510,0.0000507816865021,0.0000253908432510,1.9930766231408228,-0.9934212036678660,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9973489469544987,-0.9974025505379704
        };
        /* Band: 2: 159 - 200.327[Hz] */
        static constexpr std::array<float, 10> bandpass_2_coeffs
        {
            0.0000036604848021,0.0000073209696041,0.0000036604848021,1.9974483728787567,-0.9981010284516609,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9979577333868821,-0.9984132970629739
        };
        /* Band: 3: 200.327 - 252.397[Hz] */
        static constexpr std::array<float, 10> bandpass_3_coeffs
        {
            0.0000058080276524,0.0000116160553049,0.0000058080276524,1.9965723217555342,-0.9976080598208837,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9972782757110359,-0.9980012730977980
        };
        /* Band: 4: 252.397 - 318[Hz] */
        static constexpr std::array<float, 10> bandpass_4_coeffs
        {
            0.0000092144145305,0.0000184288290610,0.0000092144145305,1.9953437891741053,-0.9969873281821122,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9963350296156561,-0.9974823786303491
        };
        /* Band: 5: 318 - 400.655[Hz] */
        static constexpr std::array<float, 10> bandpass_5_coeffs
        {
            0.0000146164742441,0.0000292329484881,0.0000146164742441,1.9935981231422533,-0.9962058517209192,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9950083517822803,-0.9968289589364828
        };
        /* Band: 6: 400.655 - 504.794[Hz] */
        static constexpr std::array<float, 10> bandpass_6_coeffs
        {
            0.0000231812433704,0.0000463624867408,0.0000231812433704,1.9910852656256894,-0.9952222181356506,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9931176448081189,-0.9960062356874733
        };
        /* Band: 7: 504.794 - 636[Hz] */
        static constexpr std::array<float, 10> bandpass_7_coeffs
        {
            0.0000367560816023,0.0000735121632046,0.0000367560816023,1.9874228634263347,-0.9939844859748729,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9903881474023759,-0.9949704853571905
        };
        /* Band: 8: 636 - 801.31[Hz] */
        static constexpr std::array<float, 10> bandpass_8_coeffs
        {
            0.0000582631419384,0.0001165262838768,0.0000582631419384,1.9820230986587217,-0.9924276038776757,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9863990979473878,-0.9936667539469665
        };
        /* Band: 9: 801.31 - 1009.59[Hz] */
        static constexpr std::array<float, 10> bandpass_9_coeffs
        {
            0.0000923204661870,0.0001846409323741,0.0000923204661870,1.9739786474086038,-0.9904702685411013,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9805028189210709,-0.9920259854785439
        };
        /* Band: 10: 1009.59 - 1272[Hz] */
        static constexpr std::array<float, 10> bandpass_10_coeffs
        {
            0.0001462178381960,0.0002924356763920,0.0001462178381960,1.9618855016501633,-0.9880111575615337,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9716985971374403,-0.9899614008938247
        };
        /* Band: 11: 1272 - 1602.62[Hz] */
        static constexpr std::array<float, 10> bandpass_11_coeffs
        {
            0.0002314459555137,0.0004628919110275,0.0002314459555137,1.9435693549545308,-0.9849245224883534,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9584368118625362,-0.9873638994453899
        };
        /* Band: 12: 1602.62 - 2019.17[Hz] */
        static constexpr std::array<float, 10> bandpass_12_coeffs
        {
            0.0003660846695791,0.0007321693391582,0.0003660846695791,1.9156674320547964,-0.9810552459278270,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9383167623387507,-0.9840961441685229
        };
        /* Band: 13: 2019.17 - 2544[Hz] */
        static constexpr std::array<float, 10> bandpass_13_coeffs
        {
            0.0005785173244832,0.0011570346489664,0.0005785173244832,1.8730004803740419,-0.9762137248213886,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9076258509221240,-0.9799847896282214
        };
        /* Band: 14: 2544 - 3205.24[Hz] */
        static constexpr std::array<float, 10> bandpass_14_coeffs
        {
            0.0009131773564504,0.0018263547129008,0.0009131773564504,1.8076573959746691,-0.9701714833440057,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.8606504612657724,-0.9748099114933489
        };
        /* Band: 15: 3205.24 - 4038.35[Hz] */
        static constexpr std::array<float, 10> bandpass_15_coeffs
        {
            0.0014393812914308,0.0028787625828615,0.0014393812914308,1.7077305429645615,-0.9626595461894795,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.7886798312872059,-0.9682898711273570
        };
        /* Band: 16: 4038.35 - 5088[Hz] */
        static constexpr std::array<float, 10> bandpass_16_coeffs
        {
            0.0022647967131630,0.0045295934263260,0.0022647967131630,1.5557447797284123,-0.9533739999571791,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.6786533451550325,-0.9600580330493774
        };

        static constexpr std::array<std::array<float, 10>, bands> bandpass_coeffs
        {
            bandpass_1_coeffs,
            bandpass_2_coeffs,
            bandpass_3_coeffs,
            bandpass_4_coeffs,
            bandpass_5_coeffs,
            bandpass_6_coeffs,
            bandpass_7_coeffs,
            bandpass_8_coeffs,
            bandpass_9_coeffs,
            bandpass_10_coeffs,
            bandpass_11_coeffs,
            bandpass_12_coeffs,
            bandpass_13_coeffs,
            bandpass_14_coeffs,
            bandpass_15_coeffs,
            bandpass_16_coeffs,
        };

        std::array<libs::adsp::iir_biquad<2>, bands> bandpass_filters;
        std::array<libs::adsp::iir_biquad<1>, bands> lowpass_filters;
    };

    /* Lowpass filter (RMS envelope) */
    static constexpr std::array<float, 5> lowpass_coeffs { 0, 0, 1, 1.98f, -0.9801f};

    /* Highpass filter, fc = 5088Hz*/
    static constexpr std::array<float, 10> highpass_coeffs
    {
        0.2529996995574256,-0.5059993991148511,0.2529996995574256,0.3334617277963257,-0.3786640264144165,
        1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.4486195475185251,-0.8910563941509072
    };

    libs::adsp::iir_biquad<2> highpass_filter;
    std::array<float, filter_bank::bands> modulator_hold;
    std::array<float, mfx::config::dsp_vector_size> carrier_env_buf, carrier_bp_buf, modulator_env_buf;
    filter_bank carrier_fb, modulator_fb;
#else
    constexpr static uint32_t fft_size {1024};
    constexpr static uint32_t bands {64};

    /* Hanning window */
    constexpr static std::array<float, 512> band_hann
    {
        0.1250000000000000,    0.1202424707819554,    0.1066941738241592,
        0.0864177145228181,    0.0625000000000000,    0.0385822854771819,
        0.0183058261758408,    0.0047575292180446,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0000000000000000,    0.0000000000000000,
        0.0000000000000000,    0.0047575292180446,    0.0183058261758408,
        0.0385822854771819,    0.0625000000000000,    0.0864177145228181,
        0.1066941738241592,    0.1202424707819554
    };


    /* Hanning window */
    constexpr static std::array<float, 1024> window_hann
    {
        0.0000000000000000,    0.0000094123586994,    0.0000376490804277,
        0.0000847091020883,    0.0001505906518979,    0.0002352912494534,
        0.0003388077058252,    0.0004611361236773,    0.0006022718974138,
        0.0007622097133526,    0.0009409435499254,    0.0011384666779042,
        0.0013547716606549,    0.0015898503544172,    0.0018436939086110,
        0.0021162927661701,    0.0024076366639015,    0.0027177146328723,
        0.0030465149988220,    0.0033940253826027,    0.0037602327006450,
        0.0041451231654502,    0.0045486822861100,    0.0049708948688514,
        0.0054117450176095,    0.0058712161346253,    0.0063492909210708,
        0.0068459513777007,    0.0073611788055294,    0.0078949538065355,
        0.0084472562843919,    0.0090180654452224,    0.0096073597983848,
        0.0102151171572797,    0.0108413146401862,    0.0114859286711228,
        0.0121489349807357,    0.0128303086072121,    0.0135300238972199,
        0.0142480545068741,    0.0149843734027280,    0.0157389528627913,
        0.0165117644775740,    0.0173027791511553,    0.0181119671022801,
        0.0189392978654792,    0.0197847402922171,    0.0206482625520642,
        0.0215298321338956,    0.0224294158471146,    0.0233469798229031,
        0.0242824895154958,    0.0252359097034817,    0.0262072044911295,
        0.0271963373097394,    0.0282032709190198,    0.0292279674084896,
        0.0302703881989050,    0.0313304940437125,    0.0324082450305262,
        0.0335036005826305,    0.0346165194605081,    0.0357469597633922,
        0.0368948789308443,    0.0380602337443566,    0.0392429803289790,
        0.0404430741549711,    0.0416604700394786,    0.0428951221482347,
        0.0441469839972851,    0.0454160084547388,    0.0467021477425423,
        0.0480053534382783,    0.0493255764769890,    0.0506627671530231,
        0.0520168751219074,    0.0533878494022423,    0.0547756383776211,
        0.0561801897985730,    0.0576014507845311,    0.0590393678258225,
        0.0604938867856832,    0.0619649529022967,    0.0634525107908550,
        0.0649565044456443,    0.0664768772421537,    0.0680135719392066,
        0.0695665306811163,    0.0711356949998639,    0.0727210058172997,
        0.0743224034473674,    0.0759398275983514,    0.0775732173751464,
        0.0792225112815508,    0.0808876472225810,    0.0825685625068100,
        0.0842651938487274,    0.0859774773711221,    0.0877053486074874,
        0.0894487425044477,    0.0912075934242081,    0.0929818351470258,
        0.0947714008737026,    0.0965762232281003,    0.0983962342596775,
        0.1002313654460475,    0.1020815476955582,    0.1039467113498938,
        0.1058267861866968,    0.1077217014222124,    0.1096313857139528,
        0.1115557671633838,    0.1134947733186315,    0.1154483311772102,
        0.1174163671887705,    0.1193988072578691,    0.1213955767467577,
        0.1234066004781937,    0.1254318027382703,    0.1274711072792670,
        0.1295244373225204,    0.1315917155613150,    0.1336728641637936,
        0.1357678047758874,    0.1378764585242665,    0.1399987460193092,
        0.1421345873580907,    0.1442839021273918,    0.1464466094067262,
        0.1486226277713874,    0.1508118752955135,    0.1530142695551730,
        0.1552297276314665,    0.1574581661136498,    0.1596995011022734,
        0.1619536482123420,    0.1642205225764908,    0.1665000388481813,
        0.1687921112049141,    0.1710966533514607,    0.1734135785231116,
        0.1757427994889437,    0.1780842285551043,    0.1804377775681121,
        0.1828033579181773,    0.1851808805425365,    0.1875702559288068,
        0.1899713941183554,    0.1923842047096866,    0.1948085968618453,
        0.1972444792978372,    0.1996917603080655,    0.2021503477537833,
        0.2046201490705629,    0.2071010712717806,    0.2095930209521177,
        0.2120959042910773,    0.2146096270565163,    0.2171340946081934,
        0.2196692119013320,    0.2222148834901989,    0.2247710135316976,
        0.2273375057889768,    0.2299142636350535,    0.2325011900564514,
        0.2350981876568526,    0.2377051586607656,    0.2403220049172052,
        0.2429486279033892,    0.2455849287284465,    0.2482308081371412,
        0.2508861665136091,    0.2535509038851079,    0.2562249199257820,
        0.2589081139604386,    0.2616003849683389,    0.2643016315870011,
        0.2670117521160169,    0.2697306445208800,    0.2724582064368281,
        0.2751943351726967,    0.2779389277147853,    0.2806918807307361,
        0.2834530905734240,    0.2862224532848589,    0.2889998646001001,
        0.2917852199511813,    0.2945784144710480,    0.2973793429975051,
        0.3001879000771766,    0.3030039799694759,    0.3058274766505868,
        0.3086582838174551,    0.3114962948917909,    0.3143414030240812,
        0.3171935010976130,    0.3200524817325059,    0.3229182372897548,
        0.3257906598752828,    0.3286696413440028,    0.3315550733038900,
        0.3344468471200618,    0.3373448539188685,    0.3402489845919922,
        0.3431591298005542,    0.3460751799792325,    0.3489970253403859,
        0.3519245558781881,    0.3548576613727689,    0.3577962313943641,
        0.3607401553074735,    0.3636893222750255,    0.3666436212625508,
        0.3696029410423622,    0.3725671701977427,    0.3755361971271399,
        0.3785099100483680,    0.3814881970028163,    0.3844709458596643,
        0.3874580443201036,    0.3904493799215651,    0.3934448400419543,
        0.3964443119038907,    0.3994476825789540,    0.4024548389919358,
        0.4054656679250969,    0.4084800560224295,    0.4114978897939255,
        0.4145190556198493,    0.4175434397550150,    0.4205709283330693,
        0.4236014073707783,    0.4266347627723192,    0.4296708803335754,
        0.4327096457464369,    0.4357509446031034,    0.4387946624003919,
        0.4418406845440476,    0.4448888963530584,    0.4479391830639726,
        0.4509914298352196,    0.4540455217514336,    0.4571013438277801,
        0.4601587810142849,    0.4632177182001663,    0.4662780402181679,
        0.4693396318488957,    0.4724023778251550,    0.4754661628362910,
        0.4785308715325295,    0.4815963885293205,    0.4846625984116817,
        0.4877293857385439,    0.4907966350470976,    0.4938642308571400,
        0.4969320576754228,    0.4999999999999999,    0.5030679423245772,
        0.5061357691428600,    0.5092033649529023,    0.5122706142614560,
        0.5153374015883182,    0.5184036114706795,    0.5214691284674704,
        0.5245338371637090,    0.5275976221748450,    0.5306603681511043,
        0.5337219597818320,    0.5367822817998337,    0.5398412189857150,
        0.5428986561722199,    0.5459544782485662,    0.5490085701647803,
        0.5520608169360273,    0.5551111036469415,    0.5581593154559523,
        0.5612053375996081,    0.5642490553968965,    0.5672903542535630,
        0.5703291196664245,    0.5733652372276808,    0.5763985926292217,
        0.5794290716669306,    0.5824565602449849,    0.5854809443801506,
        0.5885021102060743,    0.5915199439775705,    0.5945343320749030,
        0.5975451610080641,    0.6005523174210459,    0.6035556880961093,
        0.6065551599580457,    0.6095506200784349,    0.6125419556798963,
        0.6155290541403355,    0.6185118029971837,    0.6214900899516319,
        0.6244638028728601,    0.6274328298022572,    0.6303970589576378,
        0.6333563787374492,    0.6363106777249744,    0.6392598446925265,
        0.6422037686056359,    0.6451423386272310,    0.6480754441218119,
        0.6510029746596140,    0.6539248200207675,    0.6568408701994457,
        0.6597510154080078,    0.6626551460811314,    0.6655531528799381,
        0.6684449266961100,    0.6713303586559971,    0.6742093401247172,
        0.6770817627102452,    0.6799475182674941,    0.6828064989023870,
        0.6856585969759188,    0.6885037051082091,    0.6913417161825448,
        0.6941725233494132,    0.6969960200305240,    0.6998120999228233,
        0.7026206570024949,    0.7054215855289518,    0.7082147800488185,
        0.7110001353998998,    0.7137775467151409,    0.7165469094265760,
        0.7193081192692636,    0.7220610722852145,    0.7248056648273034,
        0.7275417935631718,    0.7302693554791200,    0.7329882478839830,
        0.7356983684129988,    0.7383996150316610,    0.7410918860395613,
        0.7437750800742179,    0.7464490961148920,    0.7491138334863908,
        0.7517691918628587,    0.7544150712715536,    0.7570513720966108,
        0.7596779950827948,    0.7622948413392343,    0.7649018123431474,
        0.7674988099435485,    0.7700857363649465,    0.7726624942110232,
        0.7752289864683024,    0.7777851165098010,    0.7803307880986680,
        0.7828659053918066,    0.7853903729434836,    0.7879040957089227,
        0.7904069790478823,    0.7928989287282194,    0.7953798509294370,
        0.7978496522462166,    0.8003082396919343,    0.8027555207021627,
        0.8051914031381548,    0.8076157952903134,    0.8100286058816446,
        0.8124297440711932,    0.8148191194574635,    0.8171966420818226,
        0.8195622224318879,    0.8219157714448957,    0.8242572005110562,
        0.8265864214768883,    0.8289033466485394,    0.8312078887950860,
        0.8334999611518187,    0.8357794774235092,    0.8380463517876580,
        0.8403004988977265,    0.8425418338863502,    0.8447702723685335,
        0.8469857304448269,    0.8491881247044863,    0.8513773722286125,
        0.8535533905932737,    0.8557160978726083,    0.8578654126419093,
        0.8600012539806908,    0.8621235414757333,    0.8642321952241125,
        0.8663271358362064,    0.8684082844386849,    0.8704755626774794,
        0.8725288927207330,    0.8745681972617296,    0.8765933995218063,
        0.8786044232532423,    0.8806011927421309,    0.8825836328112295,
        0.8845516688227897,    0.8865052266813684,    0.8884442328366162,
        0.8903686142860472,    0.8922782985777875,    0.8941732138133032,
        0.8960532886501060,    0.8979184523044417,    0.8997686345539526,
        0.9016037657403224,    0.9034237767718997,    0.9052285991262974,
        0.9070181648529743,    0.9087924065757917,    0.9105512574955523,
        0.9122946513925125,    0.9140225226288778,    0.9157348061512727,
        0.9174314374931900,    0.9191123527774190,    0.9207774887184492,
        0.9224267826248536,    0.9240601724016486,    0.9256775965526326,
        0.9272789941827002,    0.9288643050001359,    0.9304334693188836,
        0.9319864280607933,    0.9335231227578464,    0.9350434955543556,
        0.9365474892091450,    0.9380350470977032,    0.9395061132143168,
        0.9409606321741775,    0.9423985492154690,    0.9438198102014269,
        0.9452243616223790,    0.9466121505977576,    0.9479831248780926,
        0.9493372328469769,    0.9506744235230109,    0.9519946465617217,
        0.9532978522574577,    0.9545839915452612,    0.9558530160027149,
        0.9571048778517653,    0.9583395299605213,    0.9595569258450289,
        0.9607570196710209,    0.9619397662556434,    0.9631051210691557,
        0.9642530402366077,    0.9653834805394919,    0.9664963994173694,
        0.9675917549694738,    0.9686695059562874,    0.9697296118010950,
        0.9707720325915103,    0.9717967290809801,    0.9728036626902605,
        0.9737927955088705,    0.9747640902965183,    0.9757175104845042,
        0.9766530201770969,    0.9775705841528853,    0.9784701678661044,
        0.9793517374479357,    0.9802152597077829,    0.9810607021345208,
        0.9818880328977200,    0.9826972208488447,    0.9834882355224260,
        0.9842610471372086,    0.9850156265972720,    0.9857519454931258,
        0.9864699761027800,    0.9871696913927879,    0.9878510650192642,
        0.9885140713288771,    0.9891586853598138,    0.9897848828427203,
        0.9903926402016152,    0.9909819345547777,    0.9915527437156082,
        0.9921050461934645,    0.9926388211944706,    0.9931540486222993,
        0.9936507090789293,    0.9941287838653747,    0.9945882549823906,
        0.9950291051311485,    0.9954513177138899,    0.9958548768345498,
        0.9962397672993550,    0.9966059746173972,    0.9969534850011781,
        0.9972822853671277,    0.9975923633360984,    0.9978837072338299,
        0.9981563060913889,    0.9984101496455828,    0.9986452283393451,
        0.9988615333220958,    0.9990590564500745,    0.9992377902866474,
        0.9993977281025862,    0.9995388638763227,    0.9996611922941747,
        0.9997647087505466,    0.9998494093481021,    0.9999152908979116,
        0.9999623509195723,    0.9999905876413006,    1.0000000000000000,
        0.9999905876413006,    0.9999623509195723,    0.9999152908979116,
        0.9998494093481021,    0.9997647087505466,    0.9996611922941747,
        0.9995388638763227,    0.9993977281025862,    0.9992377902866474,
        0.9990590564500745,    0.9988615333220958,    0.9986452283393451,
        0.9984101496455828,    0.9981563060913889,    0.9978837072338299,
        0.9975923633360985,    0.9972822853671277,    0.9969534850011781,
        0.9966059746173973,    0.9962397672993550,    0.9958548768345498,
        0.9954513177138899,    0.9950291051311486,    0.9945882549823906,
        0.9941287838653747,    0.9936507090789293,    0.9931540486222994,
        0.9926388211944707,    0.9921050461934646,    0.9915527437156082,
        0.9909819345547777,    0.9903926402016152,    0.9897848828427203,
        0.9891586853598138,    0.9885140713288771,    0.9878510650192642,
        0.9871696913927879,    0.9864699761027801,    0.9857519454931259,
        0.9850156265972720,    0.9842610471372086,    0.9834882355224261,
        0.9826972208488447,    0.9818880328977200,    0.9810607021345208,
        0.9802152597077829,    0.9793517374479358,    0.9784701678661045,
        0.9775705841528854,    0.9766530201770970,    0.9757175104845042,
        0.9747640902965184,    0.9737927955088705,    0.9728036626902606,
        0.9717967290809801,    0.9707720325915103,    0.9697296118010950,
        0.9686695059562875,    0.9675917549694739,    0.9664963994173694,
        0.9653834805394919,    0.9642530402366079,    0.9631051210691557,
        0.9619397662556435,    0.9607570196710209,    0.9595569258450289,
        0.9583395299605213,    0.9571048778517653,    0.9558530160027150,
        0.9545839915452612,    0.9532978522574578,    0.9519946465617217,
        0.9506744235230110,    0.9493372328469770,    0.9479831248780926,
        0.9466121505977576,    0.9452243616223790,    0.9438198102014270,
        0.9423985492154690,    0.9409606321741775,    0.9395061132143168,
        0.9380350470977032,    0.9365474892091451,    0.9350434955543557,
        0.9335231227578464,    0.9319864280607935,    0.9304334693188836,
        0.9288643050001361,    0.9272789941827002,    0.9256775965526327,
        0.9240601724016486,    0.9224267826248536,    0.9207774887184492,
        0.9191123527774191,    0.9174314374931900,    0.9157348061512727,
        0.9140225226288778,    0.9122946513925126,    0.9105512574955523,
        0.9087924065757919,    0.9070181648529743,    0.9052285991262974,
        0.9034237767718998,    0.9016037657403224,    0.8997686345539526,
        0.8979184523044418,    0.8960532886501061,    0.8941732138133032,
        0.8922782985777876,    0.8903686142860473,    0.8884442328366162,
        0.8865052266813686,    0.8845516688227899,    0.8825836328112295,
        0.8806011927421309,    0.8786044232532424,    0.8765933995218063,
        0.8745681972617296,    0.8725288927207331,    0.8704755626774796,
        0.8684082844386850,    0.8663271358362064,    0.8642321952241128,
        0.8621235414757336,    0.8600012539806909,    0.8578654126419094,
        0.8557160978726084,    0.8535533905932738,    0.8513773722286126,
        0.8491881247044866,    0.8469857304448269,    0.8447702723685335,
        0.8425418338863502,    0.8403004988977266,    0.8380463517876580,
        0.8357794774235093,    0.8334999611518188,    0.8312078887950860,
        0.8289033466485394,    0.8265864214768885,    0.8242572005110561,
        0.8219157714448957,    0.8195622224318879,    0.8171966420818230,
        0.8148191194574634,    0.8124297440711932,    0.8100286058816447,
        0.8076157952903136,    0.8051914031381546,    0.8027555207021628,
        0.8003082396919347,    0.7978496522462166,    0.7953798509294372,
        0.7928989287282195,    0.7904069790478825,    0.7879040957089226,
        0.7853903729434837,    0.7828659053918068,    0.7803307880986683,
        0.7777851165098011,    0.7752289864683024,    0.7726624942110234,
        0.7700857363649464,    0.7674988099435487,    0.7649018123431475,
        0.7622948413392348,    0.7596779950827948,    0.7570513720966109,
        0.7544150712715536,    0.7517691918628591,    0.7491138334863909,
        0.7464490961148921,    0.7437750800742182,    0.7410918860395612,
        0.7383996150316611,    0.7356983684129990,    0.7329882478839833,
        0.7302693554791200,    0.7275417935631719,    0.7248056648273035,
        0.7220610722852149,    0.7193081192692639,    0.7165469094265761,
        0.7137775467151413,    0.7110001353998998,    0.7082147800488185,
        0.7054215855289521,    0.7026206570024952,    0.6998120999228233,
        0.6969960200305241,    0.6941725233494134,    0.6913417161825451,
        0.6885037051082091,    0.6856585969759189,    0.6828064989023872,
        0.6799475182674940,    0.6770817627102452,    0.6742093401247174,
        0.6713303586559974,    0.6684449266961100,    0.6655531528799383,
        0.6626551460811316,    0.6597510154080077,    0.6568408701994457,
        0.6539248200207676,    0.6510029746596142,    0.6480754441218118,
        0.6451423386272312,    0.6422037686056361,    0.6392598446925268,
        0.6363106777249744,    0.6333563787374492,    0.6303970589576380,
        0.6274328298022571,    0.6244638028728601,    0.6214900899516320,
        0.6185118029971839,    0.6155290541403354,    0.6125419556798964,
        0.6095506200784351,    0.6065551599580460,    0.6035556880961093,
        0.6005523174210461,    0.5975451610080643,    0.5945343320749030,
        0.5915199439775705,    0.5885021102060745,    0.5854809443801509,
        0.5824565602449849,    0.5794290716669308,    0.5763985926292219,
        0.5733652372276812,    0.5703291196664246,    0.5672903542535632,
        0.5642490553968968,    0.5612053375996080,    0.5581593154559524,
        0.5551111036469416,    0.5520608169360275,    0.5490085701647802,
        0.5459544782485664,    0.5428986561722201,    0.5398412189857154,
        0.5367822817998337,    0.5337219597818321,    0.5306603681511045,
        0.5275976221748448,    0.5245338371637090,    0.5214691284674705,
        0.5184036114706797,    0.5153374015883182,    0.5122706142614561,
        0.5092033649529026,    0.5061357691428603,    0.5030679423245772,
        0.5000000000000001,    0.4969320576754230,    0.4938642308571399,
        0.4907966350470976,    0.4877293857385440,    0.4846625984116820,
        0.4815963885293205,    0.4785308715325297,    0.4754661628362912,
        0.4724023778251553,    0.4693396318488957,    0.4662780402181680,
        0.4632177182001665,    0.4601587810142848,    0.4571013438277801,
        0.4540455217514338,    0.4509914298352199,    0.4479391830639726,
        0.4448888963530585,    0.4418406845440478,    0.4387946624003922,
        0.4357509446031034,    0.4327096457464370,    0.4296708803335756,
        0.4266347627723190,    0.4236014073707783,    0.4205709283330694,
        0.4175434397550153,    0.4145190556198494,    0.4114978897939257,
        0.4084800560224297,    0.4054656679250972,    0.4024548389919358,
        0.3994476825789541,    0.3964443119038910,    0.3934448400419542,
        0.3904493799215651,    0.3874580443201037,    0.3844709458596647,
        0.3814881970028163,    0.3785099100483681,    0.3755361971271401,
        0.3725671701977430,    0.3696029410423622,    0.3666436212625509,
        0.3636893222750257,    0.3607401553074734,    0.3577962313943641,
        0.3548576613727690,    0.3519245558781884,    0.3489970253403859,
        0.3460751799792326,    0.3431591298005544,    0.3402489845919925,
        0.3373448539188685,    0.3344468471200619,    0.3315550733038902,
        0.3286696413440027,    0.3257906598752828,    0.3229182372897550,
        0.3200524817325062,    0.3171935010976130,    0.3143414030240813,
        0.3114962948917911,    0.3086582838174550,    0.3058274766505868,
        0.3030039799694760,    0.3001879000771768,    0.2973793429975050,
        0.2945784144710480,    0.2917852199511816,    0.2889998646001004,
        0.2862224532848590,    0.2834530905734241,    0.2806918807307364,
        0.2779389277147853,    0.2751943351726967,    0.2724582064368282,
        0.2697306445208802,    0.2670117521160169,    0.2643016315870012,
        0.2616003849683390,    0.2589081139604389,    0.2562249199257820,
        0.2535509038851080,    0.2508861665136093,    0.2482308081371411,
        0.2455849287284465,    0.2429486279033892,    0.2403220049172054,
        0.2377051586607655,    0.2350981876568527,    0.2325011900564515,
        0.2299142636350538,    0.2273375057889768,    0.2247710135316976,
        0.2222148834901991,    0.2196692119013319,    0.2171340946081934,
        0.2146096270565165,    0.2120959042910776,    0.2095930209521177,
        0.2071010712717806,    0.2046201490705630,    0.2021503477537835,
        0.1996917603080655,    0.1972444792978373,    0.1948085968618454,
        0.1923842047096865,    0.1899713941183555,    0.1875702559288069,
        0.1851808805425367,    0.1828033579181772,    0.1804377775681122,
        0.1780842285551044,    0.1757427994889440,    0.1734135785231116,
        0.1710966533514607,    0.1687921112049143,    0.1665000388481812,
        0.1642205225764908,    0.1619536482123421,    0.1596995011022737,
        0.1574581661136498,    0.1552297276314666,    0.1530142695551731,
        0.1508118752955138,    0.1486226277713874,    0.1464466094067263,
        0.1442839021273919,    0.1421345873580906,    0.1399987460193092,
        0.1378764585242667,    0.1357678047758876,    0.1336728641637935,
        0.1315917155613151,    0.1295244373225206,    0.1274711072792672,
        0.1254318027382703,    0.1234066004781939,    0.1213955767467579,
        0.1193988072578691,    0.1174163671887706,    0.1154483311772103,
        0.1134947733186317,    0.1115557671633837,    0.1096313857139528,
        0.1077217014222125,    0.1058267861866971,    0.1039467113498938,
        0.1020815476955583,    0.1002313654460476,    0.0983962342596775,
        0.0965762232281004,    0.0947714008737027,    0.0929818351470260,
        0.0912075934242081,    0.0894487425044477,    0.0877053486074875,
        0.0859774773711223,    0.0842651938487274,    0.0825685625068101,
        0.0808876472225811,    0.0792225112815508,    0.0775732173751465,
        0.0759398275983514,    0.0743224034473676,    0.0727210058172997,
        0.0711356949998640,    0.0695665306811165,    0.0680135719392068,
        0.0664768772421537,    0.0649565044456443,    0.0634525107908551,
        0.0619649529022966,    0.0604938867856833,    0.0590393678258226,
        0.0576014507845313,    0.0561801897985730,    0.0547756383776211,
        0.0533878494022424,    0.0520168751219076,    0.0506627671530231,
        0.0493255764769890,    0.0480053534382784,    0.0467021477425423,
        0.0454160084547388,    0.0441469839972852,    0.0428951221482348,
        0.0416604700394786,    0.0404430741549712,    0.0392429803289791,
        0.0380602337443567,    0.0368948789308443,    0.0357469597633923,
        0.0346165194605083,    0.0335036005826305,    0.0324082450305263,
        0.0313304940437126,    0.0302703881989052,    0.0292279674084896,
        0.0282032709190199,    0.0271963373097394,    0.0262072044911294,
        0.0252359097034817,    0.0242824895154958,    0.0233469798229032,
        0.0224294158471146,    0.0215298321338956,    0.0206482625520643,
        0.0197847402922172,    0.0189392978654792,    0.0181119671022801,
        0.0173027791511554,    0.0165117644775739,    0.0157389528627914,
        0.0149843734027280,    0.0142480545068742,    0.0135300238972199,
        0.0128303086072121,    0.0121489349807358,    0.0114859286711229,
        0.0108413146401862,    0.0102151171572797,    0.0096073597983848,
        0.0090180654452223,    0.0084472562843919,    0.0078949538065355,
        0.0073611788055294,    0.0068459513777007,    0.0063492909210708,
        0.0058712161346253,    0.0054117450176095,    0.0049708948688514,
        0.0045486822861100,    0.0041451231654503,    0.0037602327006450,
        0.0033940253826027,    0.0030465149988220,    0.0027177146328723,
        0.0024076366639015,    0.0021162927661701,    0.0018436939086110,
        0.0015898503544172,    0.0013547716606549,    0.0011384666779042,
        0.0009409435499254,    0.0007622097133526,    0.0006022718974138,
        0.0004611361236773,    0.0003388077058253,    0.0002352912494534,
        0.0001505906518979,    0.0000847091020883,    0.0000376490804277,
        0.0000094123586994,
    };


    arm_rfft_fast_instance_f32 fft;

    std::array<float, fft_size> ir_fft;
    std::array<float, 2 * fft_size> carrier_fft, modulator_fft;
    std::array<float, fft_size> carrier_input, carrier_spectrum, modulator_input, output;
#endif
    vocoder_attr attr;
};

}

#endif /* MODEL_VOCODER_VOCODER_HPP_ */
