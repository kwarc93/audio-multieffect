/*
 * vocoder.hpp
 *
 *  Created on: 24 sty 2024
 *      Author: kwarc
 */

#ifndef MODEL_VOCODER_VOCODER_HPP_
#define MODEL_VOCODER_VOCODER_HPP_

#include "app/model/effect_interface.hpp"

#include <array>

#include <libs/audio_dsp.hpp>

#define VOCODER_ALG_FFT

namespace mfx
{

class vocoder : public effect
{
public:
    vocoder (float clarity = 0.7f, unsigned channels = 64, vocoder_attr::controls::mode_type mode = vocoder_attr::controls::mode_type::modern);
    virtual ~vocoder ();

    void process(const dsp_input &in, dsp_output &out) override;
    const effect_specific_attributes get_specific_attributes(void) const override;

    void set_mode(vocoder_attr::controls::mode_type mode);
    void set_clarity(float clarity);
    void set_channels(unsigned ch_num);
    void hold(bool state);

private:
    constexpr static unsigned bands {16};

#ifndef VOCODER_ALG_FFT
    class filter_bank
    {
    public:
        filter_bank()
        {
            for (unsigned i = 0; i < this->bands; i++)
                this->bandpass_filters[i].set_coeffs(this->bandpass_coeffs[i]);

            for (auto &&f : this->lowpass_filters)
                f.set_coeffs(this->lowpass_coeffs);
        }

        void bandpass(uint32_t band, const float *in, float *out, uint32_t samples)
        {
            this->bandpass_filters[band].process(in, out, samples);
        }

        void lowpass(uint32_t band, const float *in, float *out, uint32_t samples)
        {
            this->lowpass_filters[band].process(in, out, samples);
        }

        static constexpr uint32_t bands {16};

    private:
        /* Lowpass filter (RMS envelope) */
        static constexpr std::array<float, 5> lowpass_coeffs { 0, 0, 1, 1.98f, -0.9801f};

        /* Band: 1: 50 - 159[Hz] */
        static constexpr std::array<float, 10> bandpass_1_coeffs
        {
            0.0000253908432510,0.0000507816865021,0.0000253908432510,1.9930766231408228,-0.9934212036678660,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9973489469544987,-0.9974025505379704
        };
        /* Band: 2: 159 - 200.327[Hz] */
        static constexpr std::array<float, 10> bandpass_2_coeffs
        {
            0.0000036604848021,0.0000073209696041,0.0000036604848021,1.9974483728787567,-0.9981010284516609,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9979577333868821,-0.9984132970629739
        };
        /* Band: 3: 200.327 - 252.397[Hz] */
        static constexpr std::array<float, 10> bandpass_3_coeffs
        {
            0.0000058080276524,0.0000116160553049,0.0000058080276524,1.9965723217555342,-0.9976080598208837,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9972782757110359,-0.9980012730977980
        };
        /* Band: 4: 252.397 - 318[Hz] */
        static constexpr std::array<float, 10> bandpass_4_coeffs
        {
            0.0000092144145305,0.0000184288290610,0.0000092144145305,1.9953437891741053,-0.9969873281821122,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9963350296156561,-0.9974823786303491
        };
        /* Band: 5: 318 - 400.655[Hz] */
        static constexpr std::array<float, 10> bandpass_5_coeffs
        {
            0.0000146164742441,0.0000292329484881,0.0000146164742441,1.9935981231422533,-0.9962058517209192,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9950083517822803,-0.9968289589364828
        };
        /* Band: 6: 400.655 - 504.794[Hz] */
        static constexpr std::array<float, 10> bandpass_6_coeffs
        {
            0.0000231812433704,0.0000463624867408,0.0000231812433704,1.9910852656256894,-0.9952222181356506,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9931176448081189,-0.9960062356874733
        };
        /* Band: 7: 504.794 - 636[Hz] */
        static constexpr std::array<float, 10> bandpass_7_coeffs
        {
            0.0000367560816023,0.0000735121632046,0.0000367560816023,1.9874228634263347,-0.9939844859748729,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9903881474023759,-0.9949704853571905
        };
        /* Band: 8: 636 - 801.31[Hz] */
        static constexpr std::array<float, 10> bandpass_8_coeffs
        {
            0.0000582631419384,0.0001165262838768,0.0000582631419384,1.9820230986587217,-0.9924276038776757,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9863990979473878,-0.9936667539469665
        };
        /* Band: 9: 801.31 - 1009.59[Hz] */
        static constexpr std::array<float, 10> bandpass_9_coeffs
        {
            0.0000923204661870,0.0001846409323741,0.0000923204661870,1.9739786474086038,-0.9904702685411013,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9805028189210709,-0.9920259854785439
        };
        /* Band: 10: 1009.59 - 1272[Hz] */
        static constexpr std::array<float, 10> bandpass_10_coeffs
        {
            0.0001462178381960,0.0002924356763920,0.0001462178381960,1.9618855016501633,-0.9880111575615337,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9716985971374403,-0.9899614008938247
        };
        /* Band: 11: 1272 - 1602.62[Hz] */
        static constexpr std::array<float, 10> bandpass_11_coeffs
        {
            0.0002314459555137,0.0004628919110275,0.0002314459555137,1.9435693549545308,-0.9849245224883534,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9584368118625362,-0.9873638994453899
        };
        /* Band: 12: 1602.62 - 2019.17[Hz] */
        static constexpr std::array<float, 10> bandpass_12_coeffs
        {
            0.0003660846695791,0.0007321693391582,0.0003660846695791,1.9156674320547964,-0.9810552459278270,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9383167623387507,-0.9840961441685229
        };
        /* Band: 13: 2019.17 - 2544[Hz] */
        static constexpr std::array<float, 10> bandpass_13_coeffs
        {
            0.0005785173244832,0.0011570346489664,0.0005785173244832,1.8730004803740419,-0.9762137248213886,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.9076258509221240,-0.9799847896282214
        };
        /* Band: 14: 2544 - 3205.24[Hz] */
        static constexpr std::array<float, 10> bandpass_14_coeffs
        {
            0.0009131773564504,0.0018263547129008,0.0009131773564504,1.8076573959746691,-0.9701714833440057,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.8606504612657724,-0.9748099114933489
        };
        /* Band: 15: 3205.24 - 4038.35[Hz] */
        static constexpr std::array<float, 10> bandpass_15_coeffs
        {
            0.0014393812914308,0.0028787625828615,0.0014393812914308,1.7077305429645615,-0.9626595461894795,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.7886798312872059,-0.9682898711273570
        };
        /* Band: 16: 4038.35 - 5088[Hz] */
        static constexpr std::array<float, 10> bandpass_16_coeffs
        {
            0.0022647967131630,0.0045295934263260,0.0022647967131630,1.5557447797284123,-0.9533739999571791,
            1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.6786533451550325,-0.9600580330493774
        };

        static constexpr std::array<std::array<float, 10>, bands> bandpass_coeffs
        {
            bandpass_1_coeffs,
            bandpass_2_coeffs,
            bandpass_3_coeffs,
            bandpass_4_coeffs,
            bandpass_5_coeffs,
            bandpass_6_coeffs,
            bandpass_7_coeffs,
            bandpass_8_coeffs,
            bandpass_9_coeffs,
            bandpass_10_coeffs,
            bandpass_11_coeffs,
            bandpass_12_coeffs,
            bandpass_13_coeffs,
            bandpass_14_coeffs,
            bandpass_15_coeffs,
            bandpass_16_coeffs,
        };

        std::array<libs::adsp::iir_biquad<2>, bands> bandpass_filters;
        std::array<libs::adsp::iir_biquad<1>, bands> lowpass_filters;
    };

    /* Lowpass filter (RMS envelope) */
    static constexpr std::array<float, 5> lowpass_coeffs { 0, 0, 1, 1.98f, -0.9801f};

    /* Highpass filter, fc = 5088Hz*/
    static constexpr std::array<float, 10> highpass_coeffs
    {
        0.2529996995574256,-0.5059993991148511,0.2529996995574256,0.3334617277963257,-0.3786640264144165,
        1.0000000000000000,-2.0000000000000000,1.0000000000000000,1.4486195475185251,-0.8910563941509072
    };

    libs::adsp::iir_biquad<2> highpass_filter;
    std::array<float, filter_bank::bands> modulator_hold;
    std::array<float, mfx::config::dsp_vector_size> carrier_env_buf, carrier_bp_buf, modulator_env_buf;
    filter_bank carrier_fb, modulator_fb;
#else
    constexpr static unsigned window_size {1024};

    /* Hanning window for 7/8 overlap */
    constexpr static std::array<float, 1024> window_hann
    {
        0.0000000000000000,    0.0000023530896749,    0.0000094122701069,
        0.0000211772755221,    0.0000376476629745,    0.0000588228123634,
        0.0000847019264563,    0.0001152840309193,    0.0001505679743534,
        0.0001905524283382,    0.0002352358874814,    0.0002846166694760,
        0.0003386929151637,    0.0003974625886043,    0.0004609234771527,
        0.0005290731915425,    0.0006019091659754,    0.0006794286582181,
        0.0007616287497055,    0.0008485063456507,    0.0009400581751613,
        0.0010362807913626,    0.0011371705715275,    0.0012427237172129,
        0.0013529362544024,    0.0014678040336563,    0.0015873227302677,
        0.0017114878444252,    0.0018402947013823,    0.0019737384516339,
        0.0021118140710980,    0.0022545163613056,    0.0024018399495962,
        0.0025537792893199,    0.0027103286600465,    0.0028714821677807,
        0.0030372337451839,    0.0032075771518030,    0.0033825059743050,
        0.0035620136267185,    0.0037460933506820,    0.0039347382156978,
        0.0041279411193935,    0.0043256947877888,    0.0045279917755700,
        0.0047348244663698,    0.0049461850730543,    0.0051620656380161,
        0.0053824580334739,    0.0056073539617787,    0.0058367449557258,
        0.0060706223788740,    0.0063089774258704,    0.0065518011227824,
        0.0067990843274348,    0.0070508177297550,    0.0073069918521224,
        0.0075675970497263,    0.0078326235109281,    0.0081020612576315,
        0.0083759001456576,    0.0086541298651270,    0.0089367399408481,
        0.0092237197327111,    0.0095150584360892,    0.0098107450822447,
        0.0101107685387428,    0.0104151175098697,    0.0107237805370587,
        0.0110367459993213,    0.0113540021136847,    0.0116755369356356,
        0.0120013383595696,    0.0123313941192472,    0.0126656917882558,
        0.0130042187804768,    0.0133469623505606,    0.0136939095944053,
        0.0140450474496433,    0.0144003626961328,    0.0147598419564556,
        0.0151234716964208,    0.0154912382255742,    0.0158631276977137,
        0.0162391261114111,    0.0166192193105384,    0.0170033929848016,
        0.0173916326702791,    0.0177839237499660,    0.0181802514543249,
        0.0185806008618419,    0.0189849568995878,    0.0193933043437866,
        0.0198056278203877,    0.0202219118056452,    0.0206421406267025,
        0.0210662984621818,    0.0214943693427805,    0.0219263371518718,
        0.0223621856261119,    0.0228018983560520,    0.0232454587867564,
        0.0236928502184257,    0.0241440558070251,    0.0245990585649194,
        0.0250578413615119,    0.0255203869238896,    0.0259866778374735,
        0.0264566965466742,    0.0269304253555531,    0.0274078464284882,
        0.0278889417908459,    0.0283736933296579,    0.0288620827943025,
        0.0293540917971926,    0.0298497018144673,    0.0303488941866894,
        0.0308516501195484,    0.0313579506845676,    0.0318677768198167,
        0.0323811093306301,    0.0328979288903288,    0.0334182160409484,
        0.0339419511939719,    0.0344691146310666,    0.0349996865048273,
        0.0355336468395227,    0.0360709755318479,    0.0366116523516816,
        0.0371556569428468,    0.0377029688238784,    0.0382535673887932,
        0.0388074319078666,    0.0393645415284125,    0.0399248752755684,
        0.0404884120530855,    0.0410551306441227,    0.0416250097120453,
        0.0421980278012285,    0.0427741633378652,    0.0433533946307779,
        0.0439356998722359,    0.0445210571387761,    0.0451094443920280,
        0.0457008394795443,    0.0462952201356341,    0.0468925639822017,
        0.0474928485295888,    0.0480960511774216,    0.0487021492154613,
        0.0493111198244593,    0.0499229400770164,    0.0505375869384458,
        0.0511550372676407,    0.0517752678179451,    0.0523982552380294,
        0.0530239760727693,    0.0536524067641291,    0.0542835236520483,
        0.0549173029753330,    0.0555537208725497,    0.0561927533829244,
        0.0568343764472442,    0.0574785659087634,    0.0581252975141128,
        0.0587745469142131,    0.0594262896651914,    0.0600805012293013,
        0.0607371569758473,    0.0613962321821116,    0.0620577020342853,
        0.0627215416284023,    0.0633877259712770,    0.0640562299814455,
        0.0647270284901096,    0.0654000962420847,    0.0660754078967503,
        0.0667529380290042,    0.0674326611302200,    0.0681145516092070,
        0.0687985837931742,    0.0694847319286963,    0.0701729701826840,
        0.0708632726433560,    0.0715556133212147,    0.0722499661500250,
        0.0729463049877953,    0.0736446036177620,    0.0743448357493763,
        0.0750469750192942,    0.0757509949923690,    0.0764568691626467,
        0.0771645709543638,    0.0778740737229477,    0.0785853507560203,
        0.0792983752744033,    0.0800131204331265,    0.0807295593224387,
        0.0814476649688207,    0.0821674103360007,    0.0828887683259725,
        0.0836117117800154,    0.0843362134797171,    0.0850622461479980,
        0.0857897824501385,    0.0865187949948081,    0.0872492563350965,
        0.0879811389695470,    0.0887144153431922,    0.0894490578485910,
        0.0901850388268684,    0.0909223305687564,    0.0916609053156377,
        0.0924007352605906,    0.0931417925494357,    0.0938840492817850,
        0.0946274775120920,    0.0953720492507041,    0.0961177364649161,
        0.0968645110800259,    0.0976123449803913,    0.0983612100104886,
        0.0991110779759727,    0.0998619206447385,    0.1006137097479840,
        0.1013664169812742,    0.1021200140056074,    0.1028744724484814,
        0.1036297639049623,    0.1043858599387537,    0.1051427320832673,
        0.1059003518426946,    0.1066586906930798,    0.1074177200833938,
        0.1081774114366092,    0.1089377361507758,    0.1096986656000980,
        0.1104601711360119,    0.1112222240882646,    0.1119847957659932,
        0.1127478574588049,    0.1135113804378584,    0.1142753359569450,
        0.1150396952535712,    0.1158044295500416,    0.1165695100545420,
        0.1173349079622239,    0.1181005944562887,    0.1188665407090727,
        0.1196327178831324,    0.1203990971323301,    0.1211656496029204,
        0.1219323464346360,    0.1226991587617744,    0.1234660577142850,
        0.1242330144188557,    0.1250000000000000,    0.1257669855811443,
        0.1265339422857150,    0.1273008412382256,    0.1280676535653640,
        0.1288343503970796,    0.1296009028676699,    0.1303672821168676,
        0.1311334592909273,    0.1318994055437112,    0.1326650920377761,
        0.1334304899454580,    0.1341955704499584,    0.1349603047464288,
        0.1357246640430550,    0.1364886195621416,    0.1372521425411951,
        0.1380152042340068,    0.1387777759117354,    0.1395398288639881,
        0.1403013343999020,    0.1410622638492241,    0.1418225885633908,
        0.1425822799166061,    0.1433413093069202,    0.1440996481573054,
        0.1448572679167326,    0.1456141400612462,    0.1463702360950377,
        0.1471255275515186,    0.1478799859943926,    0.1486335830187258,
        0.1493862902520160,    0.1501380793552615,    0.1508889220240273,
        0.1516387899895114,    0.1523876550196087,    0.1531354889199741,
        0.1538822635350839,    0.1546279507492959,    0.1553725224879080,
        0.1561159507182150,    0.1568582074505643,    0.1575992647394094,
        0.1583390946843623,    0.1590776694312436,    0.1598149611731316,
        0.1605509421514090,    0.1612855846568078,    0.1620188610304530,
        0.1627507436649035,    0.1634812050051919,    0.1642102175498614,
        0.1649377538520020,    0.1656637865202829,    0.1663882882199845,
        0.1671112316740275,    0.1678325896639993,    0.1685523350311793,
        0.1692704406775613,    0.1699868795668735,    0.1707016247255967,
        0.1714146492439797,    0.1721259262770523,    0.1728354290456362,
        0.1735431308373533,    0.1742490050076310,    0.1749530249807058,
        0.1756551642506237,    0.1763553963822380,    0.1770536950122046,
        0.1777500338499750,    0.1784443866787852,    0.1791367273566440,
        0.1798270298173159,    0.1805152680713036,    0.1812014162068258,
        0.1818854483907930,    0.1825673388697800,    0.1832470619709957,
        0.1839245921032497,    0.1845999037579152,    0.1852729715098903,
        0.1859437700185545,    0.1866122740287230,    0.1872784583715977,
        0.1879422979657147,    0.1886037678178884,    0.1892628430241527,
        0.1899194987706987,    0.1905737103348086,    0.1912254530857868,
        0.1918747024858871,    0.1925214340912366,    0.1931656235527558,
        0.1938072466170756,    0.1944462791274502,    0.1950826970246670,
        0.1957164763479516,    0.1963475932358709,    0.1969760239272307,
        0.1976017447619706,    0.1982247321820549,    0.1988449627323592,
        0.1994624130615542,    0.2000770599229836,    0.2006888801755407,
        0.2012978507845387,    0.2019039488225783,    0.2025071514704112,
        0.2031074360177983,    0.2037047798643659,    0.2042991605204557,
        0.2048905556079720,    0.2054789428612239,    0.2060643001277641,
        0.2066466053692221,    0.2072258366621348,    0.2078019721987715,
        0.2083749902879547,    0.2089448693558773,    0.2095115879469145,
        0.2100751247244316,    0.2106354584715875,    0.2111925680921334,
        0.2117464326112067,    0.2122970311761216,    0.2128443430571531,
        0.2133883476483184,    0.2139290244681521,    0.2144663531604773,
        0.2150003134951727,    0.2155308853689333,    0.2160580488060281,
        0.2165817839590516,    0.2171020711096712,    0.2176188906693698,
        0.2181322231801832,    0.2186420493154324,    0.2191483498804516,
        0.2196511058133106,    0.2201502981855327,    0.2206459082028074,
        0.2211379172056974,    0.2216263066703421,    0.2221110582091541,
        0.2225921535715118,    0.2230695746444469,    0.2235433034533258,
        0.2240133221625265,    0.2244796130761104,    0.2249421586384882,
        0.2254009414350806,    0.2258559441929749,    0.2263071497815743,
        0.2267545412132436,    0.2271981016439479,    0.2276378143738881,
        0.2280736628481281,    0.2285056306572195,    0.2289337015378182,
        0.2293578593732975,    0.2297780881943547,    0.2301943721796123,
        0.2306066956562134,    0.2310150431004122,    0.2314193991381581,
        0.2318197485456751,    0.2322160762500340,    0.2326083673297209,
        0.2329966070151983,    0.2333807806894616,    0.2337608738885889,
        0.2341368723022862,    0.2345087617744258,    0.2348765283035792,
        0.2352401580435444,    0.2355996373038672,    0.2359549525503567,
        0.2363060904055947,    0.2366530376494394,    0.2369957812195231,
        0.2373343082117442,    0.2376686058807527,    0.2379986616404304,
        0.2383244630643644,    0.2386459978863153,    0.2389632540006787,
        0.2392762194629413,    0.2395848824901303,    0.2398892314612572,
        0.2401892549177552,    0.2404849415639108,    0.2407762802672889,
        0.2410632600591519,    0.2413458701348730,    0.2416240998543424,
        0.2418979387423685,    0.2421673764890719,    0.2424324029502737,
        0.2426930081478776,    0.2429491822702450,    0.2432009156725651,
        0.2434481988772176,    0.2436910225741296,    0.2439293776211260,
        0.2441632550442742,    0.2443926460382213,    0.2446175419665261,
        0.2448379343619839,    0.2450538149269457,    0.2452651755336302,
        0.2454720082244300,    0.2456743052122112,    0.2458720588806065,
        0.2460652617843022,    0.2462539066493180,    0.2464379863732815,
        0.2466174940256950,    0.2467924228481970,    0.2469627662548161,
        0.2471285178322193,    0.2472896713399534,    0.2474462207106801,
        0.2475981600504038,    0.2477454836386944,    0.2478881859289020,
        0.2480262615483661,    0.2481597052986176,    0.2482885121555748,
        0.2484126772697323,    0.2485321959663437,    0.2486470637455976,
        0.2487572762827871,    0.2488628294284725,    0.2489637192086374,
        0.2490599418248388,    0.2491514936543493,    0.2492383712502945,
        0.2493205713417819,    0.2493980908340246,    0.2494709268084575,
        0.2495390765228472,    0.2496025374113957,    0.2496613070848363,
        0.2497153833305240,    0.2497647641125186,    0.2498094475716618,
        0.2498494320256466,    0.2498847159690807,    0.2499152980735437,
        0.2499411771876366,    0.2499623523370255,    0.2499788227244779,
        0.2499905877298931,    0.2499976469103251,    0.2500000000000000,
        0.2499976469103251,    0.2499905877298931,    0.2499788227244779,
        0.2499623523370255,    0.2499411771876366,    0.2499152980735437,
        0.2498847159690807,    0.2498494320256466,    0.2498094475716618,
        0.2497647641125186,    0.2497153833305240,    0.2496613070848363,
        0.2496025374113957,    0.2495390765228472,    0.2494709268084575,
        0.2493980908340246,    0.2493205713417819,    0.2492383712502945,
        0.2491514936543493,    0.2490599418248388,    0.2489637192086374,
        0.2488628294284725,    0.2487572762827872,    0.2486470637455976,
        0.2485321959663437,    0.2484126772697323,    0.2482885121555748,
        0.2481597052986177,    0.2480262615483662,    0.2478881859289020,
        0.2477454836386944,    0.2475981600504038,    0.2474462207106801,
        0.2472896713399534,    0.2471285178322193,    0.2469627662548161,
        0.2467924228481970,    0.2466174940256950,    0.2464379863732815,
        0.2462539066493180,    0.2460652617843022,    0.2458720588806065,
        0.2456743052122112,    0.2454720082244300,    0.2452651755336302,
        0.2450538149269457,    0.2448379343619839,    0.2446175419665261,
        0.2443926460382214,    0.2441632550442742,    0.2439293776211260,
        0.2436910225741296,    0.2434481988772176,    0.2432009156725652,
        0.2429491822702450,    0.2426930081478776,    0.2424324029502737,
        0.2421673764890719,    0.2418979387423685,    0.2416240998543424,
        0.2413458701348730,    0.2410632600591520,    0.2407762802672889,
        0.2404849415639109,    0.2401892549177552,    0.2398892314612572,
        0.2395848824901303,    0.2392762194629413,    0.2389632540006787,
        0.2386459978863153,    0.2383244630643644,    0.2379986616404304,
        0.2376686058807528,    0.2373343082117443,    0.2369957812195231,
        0.2366530376494394,    0.2363060904055947,    0.2359549525503568,
        0.2355996373038672,    0.2352401580435444,    0.2348765283035792,
        0.2345087617744258,    0.2341368723022863,    0.2337608738885889,
        0.2333807806894616,    0.2329966070151984,    0.2326083673297209,
        0.2322160762500340,    0.2318197485456751,    0.2314193991381582,
        0.2310150431004122,    0.2306066956562134,    0.2301943721796123,
        0.2297780881943548,    0.2293578593732975,    0.2289337015378182,
        0.2285056306572195,    0.2280736628481282,    0.2276378143738881,
        0.2271981016439480,    0.2267545412132436,    0.2263071497815743,
        0.2258559441929749,    0.2254009414350806,    0.2249421586384882,
        0.2244796130761104,    0.2240133221625265,    0.2235433034533258,
        0.2230695746444469,    0.2225921535715118,    0.2221110582091541,
        0.2216263066703421,    0.2211379172056975,    0.2206459082028074,
        0.2201502981855327,    0.2196511058133106,    0.2191483498804516,
        0.2186420493154324,    0.2181322231801833,    0.2176188906693699,
        0.2171020711096713,    0.2165817839590516,    0.2160580488060282,
        0.2155308853689334,    0.2150003134951727,    0.2144663531604774,
        0.2139290244681521,    0.2133883476483185,    0.2128443430571532,
        0.2122970311761216,    0.2117464326112067,    0.2111925680921334,
        0.2106354584715875,    0.2100751247244317,    0.2095115879469145,
        0.2089448693558773,    0.2083749902879547,    0.2078019721987715,
        0.2072258366621348,    0.2066466053692221,    0.2060643001277640,
        0.2054789428612239,    0.2048905556079720,    0.2042991605204557,
        0.2037047798643659,    0.2031074360177983,    0.2025071514704112,
        0.2019039488225784,    0.2012978507845387,    0.2006888801755407,
        0.2000770599229837,    0.1994624130615542,    0.1988449627323593,
        0.1982247321820549,    0.1976017447619706,    0.1969760239272307,
        0.1963475932358709,    0.1957164763479517,    0.1950826970246671,
        0.1944462791274503,    0.1938072466170756,    0.1931656235527558,
        0.1925214340912366,    0.1918747024858872,    0.1912254530857869,
        0.1905737103348087,    0.1899194987706987,    0.1892628430241527,
        0.1886037678178884,    0.1879422979657148,    0.1872784583715977,
        0.1866122740287230,    0.1859437700185546,    0.1852729715098903,
        0.1845999037579153,    0.1839245921032497,    0.1832470619709958,
        0.1825673388697800,    0.1818854483907930,    0.1812014162068259,
        0.1805152680713037,    0.1798270298173160,    0.1791367273566440,
        0.1784443866787853,    0.1777500338499750,    0.1770536950122046,
        0.1763553963822380,    0.1756551642506238,    0.1749530249807058,
        0.1742490050076310,    0.1735431308373533,    0.1728354290456363,
        0.1721259262770523,    0.1714146492439797,    0.1707016247255968,
        0.1699868795668735,    0.1692704406775613,    0.1685523350311794,
        0.1678325896639994,    0.1671112316740275,    0.1663882882199846,
        0.1656637865202829,    0.1649377538520019,    0.1642102175498614,
        0.1634812050051919,    0.1627507436649036,    0.1620188610304530,
        0.1612855846568078,    0.1605509421514090,    0.1598149611731317,
        0.1590776694312436,    0.1583390946843623,    0.1575992647394095,
        0.1568582074505643,    0.1561159507182150,    0.1553725224879080,
        0.1546279507492960,    0.1538822635350839,    0.1531354889199741,
        0.1523876550196088,    0.1516387899895115,    0.1508889220240273,
        0.1501380793552615,    0.1493862902520161,    0.1486335830187258,
        0.1478799859943926,    0.1471255275515186,    0.1463702360950377,
        0.1456141400612462,    0.1448572679167327,    0.1440996481573055,
        0.1433413093069203,    0.1425822799166062,    0.1418225885633908,
        0.1410622638492242,    0.1403013343999020,    0.1395398288639881,
        0.1387777759117354,    0.1380152042340069,    0.1372521425411951,
        0.1364886195621416,    0.1357246640430550,    0.1349603047464288,
        0.1341955704499584,    0.1334304899454580,    0.1326650920377761,
        0.1318994055437112,    0.1311334592909273,    0.1303672821168676,
        0.1296009028676699,    0.1288343503970796,    0.1280676535653640,
        0.1273008412382257,    0.1265339422857151,    0.1257669855811443,
        0.1250000000000000,    0.1242330144188557,    0.1234660577142850,
        0.1226991587617744,    0.1219323464346360,    0.1211656496029205,
        0.1203990971323301,    0.1196327178831324,    0.1188665407090728,
        0.1181005944562888,    0.1173349079622239,    0.1165695100545420,
        0.1158044295500416,    0.1150396952535712,    0.1142753359569450,
        0.1135113804378584,    0.1127478574588050,    0.1119847957659932,
        0.1112222240882646,    0.1104601711360119,    0.1096986656000981,
        0.1089377361507758,    0.1081774114366092,    0.1074177200833939,
        0.1066586906930798,    0.1059003518426946,    0.1051427320832674,
        0.1043858599387538,    0.1036297639049623,    0.1028744724484814,
        0.1021200140056074,    0.1013664169812743,    0.1006137097479840,
        0.0998619206447385,    0.0991110779759727,    0.0983612100104886,
        0.0976123449803913,    0.0968645110800259,    0.0961177364649162,
        0.0953720492507041,    0.0946274775120920,    0.0938840492817850,
        0.0931417925494357,    0.0924007352605906,    0.0916609053156377,
        0.0909223305687564,    0.0901850388268683,    0.0894490578485910,
        0.0887144153431922,    0.0879811389695471,    0.0872492563350965,
        0.0865187949948082,    0.0857897824501386,    0.0850622461479981,
        0.0843362134797171,    0.0836117117800155,    0.0828887683259726,
        0.0821674103360007,    0.0814476649688207,    0.0807295593224387,
        0.0800131204331266,    0.0792983752744033,    0.0785853507560203,
        0.0778740737229478,    0.0771645709543637,    0.0764568691626467,
        0.0757509949923690,    0.0750469750192942,    0.0743448357493763,
        0.0736446036177620,    0.0729463049877954,    0.0722499661500251,
        0.0715556133212147,    0.0708632726433560,    0.0701729701826841,
        0.0694847319286963,    0.0687985837931742,    0.0681145516092070,
        0.0674326611302201,    0.0667529380290042,    0.0660754078967503,
        0.0654000962420848,    0.0647270284901097,    0.0640562299814455,
        0.0633877259712770,    0.0627215416284023,    0.0620577020342853,
        0.0613962321821116,    0.0607371569758473,    0.0600805012293014,
        0.0594262896651914,    0.0587745469142132,    0.0581252975141129,
        0.0574785659087634,    0.0568343764472442,    0.0561927533829244,
        0.0555537208725498,    0.0549173029753330,    0.0542835236520484,
        0.0536524067641291,    0.0530239760727694,    0.0523982552380294,
        0.0517752678179452,    0.0511550372676408,    0.0505375869384459,
        0.0499229400770164,    0.0493111198244593,    0.0487021492154614,
        0.0480960511774216,    0.0474928485295889,    0.0468925639822017,
        0.0462952201356342,    0.0457008394795443,    0.0451094443920280,
        0.0445210571387761,    0.0439356998722360,    0.0433533946307779,
        0.0427741633378652,    0.0421980278012286,    0.0416250097120453,
        0.0410551306441227,    0.0404884120530855,    0.0399248752755684,
        0.0393645415284124,    0.0388074319078666,    0.0382535673887933,
        0.0377029688238785,    0.0371556569428468,    0.0366116523516816,
        0.0360709755318480,    0.0355336468395226,    0.0349996865048273,
        0.0344691146310667,    0.0339419511939719,    0.0334182160409484,
        0.0328979288903288,    0.0323811093306301,    0.0318677768198168,
        0.0313579506845676,    0.0308516501195485,    0.0303488941866895,
        0.0298497018144673,    0.0293540917971926,    0.0288620827943026,
        0.0283736933296579,    0.0278889417908459,    0.0274078464284882,
        0.0269304253555531,    0.0264566965466743,    0.0259866778374735,
        0.0255203869238896,    0.0250578413615119,    0.0245990585649194,
        0.0241440558070251,    0.0236928502184257,    0.0232454587867565,
        0.0228018983560520,    0.0223621856261119,    0.0219263371518719,
        0.0214943693427806,    0.0210662984621818,    0.0206421406267025,
        0.0202219118056453,    0.0198056278203877,    0.0193933043437866,
        0.0189849568995879,    0.0185806008618419,    0.0181802514543249,
        0.0177839237499660,    0.0173916326702791,    0.0170033929848017,
        0.0166192193105384,    0.0162391261114111,    0.0158631276977138,
        0.0154912382255742,    0.0151234716964208,    0.0147598419564556,
        0.0144003626961328,    0.0140450474496433,    0.0136939095944053,
        0.0133469623505606,    0.0130042187804769,    0.0126656917882558,
        0.0123313941192473,    0.0120013383595696,    0.0116755369356356,
        0.0113540021136847,    0.0110367459993213,    0.0107237805370587,
        0.0104151175098697,    0.0101107685387428,    0.0098107450822448,
        0.0095150584360892,    0.0092237197327111,    0.0089367399408481,
        0.0086541298651271,    0.0083759001456576,    0.0081020612576316,
        0.0078326235109281,    0.0075675970497263,    0.0073069918521224,
        0.0070508177297550,    0.0067990843274349,    0.0065518011227823,
        0.0063089774258704,    0.0060706223788740,    0.0058367449557258,
        0.0056073539617787,    0.0053824580334739,    0.0051620656380161,
        0.0049461850730543,    0.0047348244663698,    0.0045279917755700,
        0.0043256947877888,    0.0041279411193935,    0.0039347382156978,
        0.0037460933506820,    0.0035620136267185,    0.0033825059743050,
        0.0032075771518030,    0.0030372337451839,    0.0028714821677807,
        0.0027103286600465,    0.0025537792893199,    0.0024018399495962,
        0.0022545163613056,    0.0021118140710980,    0.0019737384516339,
        0.0018402947013824,    0.0017114878444252,    0.0015873227302677,
        0.0014678040336563,    0.0013529362544024,    0.0012427237172129,
        0.0011371705715275,    0.0010362807913626,    0.0009400581751613,
        0.0008485063456507,    0.0007616287497055,    0.0006794286582181,
        0.0006019091659754,    0.0005290731915425,    0.0004609234771527,
        0.0003974625886043,    0.0003386929151637,    0.0002846166694760,
        0.0002352358874814,    0.0001905524283382,    0.0001505679743534,
        0.0001152840309193,    0.0000847019264563,    0.0000588228123634,
        0.0000376476629745,    0.0000211772755221,    0.0000094122701069,
        0.0000023530896749,
    };

    arm_rfft_fast_instance_f32 fft, fft_conv;

    std::array<float, 2 * window_size> carrier_env, modulator_env;
    std::array<float, window_size> carrier_input, carrier_stfft, modulator_input, output, channel_fft;
#endif
    vocoder_attr attr;
};

}

#endif /* MODEL_VOCODER_VOCODER_HPP_ */
